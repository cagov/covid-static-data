name: Track dashboard data updates (multiple files)
on:
  push:
    branches:
      - main
    paths:
      - 'data/dashboard/confirmed-deaths/california.json'
      - 'data/dashboard/positivity-rate/california.json'

# Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: szenius/set-timezone@v1.0
        with:
          timezoneLinux: "UTC"

      - name: Verify Changed files
        uses: tj-actions/verify-changed-files@v8.8
        id: verify-changed-files
        with:
          files: |
             data/dashboard/confirmed-deaths/california.json
             data/dashboard/positivity-rate/california.json

      - uses: actions/checkout@v2

      - name: debugging
        run: |
          echo "FILES CHANGED"
          echo '${{ steps.verify-changed-files.outputs.changed_files}}'

      # - name: Update time stamp (deaths)
      #   if: contains(steps.verify-changed-files.outputs.changed_files, 'data/dashboard/confirmed-deaths/california.json')
      #   run: |
      #     git config user.name github-actions
      #     git config user.email github-actions@github.com
      #     git config pull.rebase true
      #     sleep 30
      #     git pull
      #     node src/logUpdateTime.js ./data/status/last_deaths_update.json
      #     git add data/status/last_deaths_update.json
      #     git commit -m "updated last deaths status"
      #     git pull
      #     git push origin main

      # - name: Update time stamp (dashboard)
      #   if: contains(steps.verify-changed-files.outputs.changed_files, 'data/dashboard/positivity-rate/california.json')
      #   run: |
      #     git config user.name github-actions
      #     git config user.email github-actions@github.com
      #     git config pull.rebase true
      #     sleep 30
      #     git pull
      #     node src/logUpdateTime.js ./data/status/last_posrate_update.json
      #     git add data/status/last_posrate_update.json
      #     git commit -m "updated last posrate status"
      #     git pull
      #     git push origin main


      # # Push built site files to S3 production bucket    
      # - name: Deploy to S3 (data/status)
      #   uses: jakejarvis/s3-sync-action@v0.5.1
      #   with:
      #     args: --acl public-read --follow-symlinks --delete
      #   env:
      #     AWS_S3_BUCKET: 'data.covid19.ca.gov'
      #     AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      #     AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      #     AWS_REGION: 'us-west-1'
      #     SOURCE_DIR: ./data/status
      #     DEST_DIR: data/status

      # #
      # # Invalidate Cloudfront production distribution
      # - name: invalidate
      #   uses: chetan/invalidate-cloudfront-action@v1.3
      #   env:
      #     DISTRIBUTION: 'EHNPIZWYYWA31'
      #     PATHS: '/data/status/* /data/status'
      #     AWS_REGION: 'us-west-1'
      #     AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      #     AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
